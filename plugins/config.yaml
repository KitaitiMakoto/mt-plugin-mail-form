#
# MailForm.pl
# 2006/03/05 1.00 First Release
# 2006/06/14 1.10 Version up
# 2006/10/18 1.11 For Ajax
# 2007/01/23 1.20 Version up
# 2007/01/27 1.20.1 Bug fix(XSS)
# 2007/08/26 1.30.1 Bug Fix
# 2008/01/09 2.00 Renewal
# 2008/06/24 2.10 For Movable Type 4.2
# 2008/08/08 2.10b Bug fix
# 2009/09/25 2.20beta1 For Movable Type 5
# 2010/03/21 2.20 For Movable Type 5
# 2011/05/12 2.30b1 For Movable Type 5.1
# 2012/07/25 2.30 For Movable Type 5.2
# 2013/08/04 2.32 Added eigar theme
#
# Copyright(c) by H.Fujimoto
#
id: mailform
name: Mail Form
version: 2.32
author_name: <__trans phrase="Hajime Fujimoto">
author_link: http://www.h-fj.com/blog/
doc_link: http://www.h-fj.com/blog/mt5plgdoc/mailformv2_3.php
description: <__trans phrase="This plugin allows you to create mail form by Movable Type template.">
blog_config_template: blog_config_template.tmpl
l10n_class: MailForm::L10N
schema_version: 1.02
tags:
  function:
    MailPreviewAuthor: $MailForm::MailForm::Tags::mail_preview_author
    MailPreviewEMail: $MailForm::MailForm::Tags::mail_preview_email
    MailPreviewEMailConfirm: $MailForm::MailForm::Tags::mail_preview_email_confirm
    MailPreviewSubject: $MailForm::MailForm::Tags::mail_preview_subject
    MailPreviewBody: $MailForm::MailForm::Tags::mail_preview_body
    MailPreviewExtParam: $MailForm::MailForm::Tags::mail_preview_ext_param
    MailFormAjaxJS: $MailForm::MailForm::Tags::mail_form_ajax_js
    IncludeMailFormCommon: $MailForm::MailForm::Tags::include_mail_form_common
    MailFormPluginVersion: $MailForm::MailForm::Tags::mail_form_plugin_version
  block:
    'MailPreviewIfError?': $MailForm::MailForm::Tags::mail_preview_if_error
    'MailPreviewIfInputError?': $MailForm::MailForm::Tags::mail_preview_if_input_error
    'MailPreviewIfFieldError?': $MailForm::MailForm::Tags::mail_preview_if_field_error
    'MailPreviewIfEMailError?': $MailForm::MailForm::Tags::mail_preview_if_email_error
    'MailPreviewIfEMailDifferent?': $MailForm::MailForm::Tags::mail_preview_if_email_different
    'MailPreviewIfNotChecked?': $MailForm::MailForm::Tags::mail_preview_if_not_checked
    'MailIfSendError?': $MailForm::MailForm::Tags::mail_if_send_error
    'MailIfAutoReplyError?': $MailForm::MailForm::Tags::mail_if_auto_reply_error
    'MailIfThrottled?': $MailForm::MailForm::Tags::mail_if_throttled
    'MailIfIPBanned?': $MailForm::MailForm::Tags::mail_if_ipbanned
    'MailIfSpam?': $MailForm::MailForm::Tags::mail_if_spam
    'MailIfSystemTemplate?': $MailForm::MailForm::Tags::mail_if_system_template
    MailBodyContainer: $MailForm::MailForm::Tags::mail_body_container
object_types:
  mailform_setting: MailForm::Setting
applications:
  cms:
    menus:
      mailform:
        label: "Mail Form"
        order: 750
      mailform:manage:
        label: Manage
        mode: fjmf_manage_setting
        mode: list
        args: {  _type => 'mailform_setting' }
        order: 100
        permission: administer_blog,administer_website
        view: [ 'blog', 'website', 'system' ]
      mailform:create:
        label: New
        mode: fjmf_do_setting
        order: 200
        permission: administer_blog,administer_website
        view: [ 'blog', 'website' ]
      mailform:sample_tmpl:
        label: Sample template
        mode: fjmf_install_template_setup
        order: 300
        permission: administer_blog,administer_website
        view: [ 'blog', 'website' ]
    methods:
      fjmf_do_setting:
        sub { runner('MailForm::DoSetting'
               'do_setting', @_); }
      fjmf_manage_setting:
        sub { runner('MailForm::DoSetting'
               'list_setting', @_); }
      fjmf_save_setting:
        sub { runner('MailForm::DoSetting'
               'save_setting', @_); }
      fjmf_insert_tag:
        sub { runner('MailForm::DoSetting'
               'insert_tag', @_); }
      fjmf_rebuild:
        sub { runner('MailForm::DoSetting'
               'rebuild', @_); }
      fjmf_install_template_setup:
        sub { runner('MailForm::DoSetting'
               'install_template_setup', @_); }
      fjmf_install_template:
        sub { runner('MailForm::DoSetting'
               'install_template', @_); }
    list_actions:
      mailform_setting:
        delete:
          label: Delete
          code: $mailform::CMS::Common::delete
          mode: delete
          order: 110
          js_message:  delete
          button: 1
  mailform:
    handler: MailForm
    script: sub {
      return MT->config->MailFormScript ||
           'mt-mail-form.cgi';
    cgi_path: sub {
      my $path = MT->config->MailFormCGIPath;
      if (!$path) {
        $path = MT->config->CGIPath;
        $path =~ s!/$!!;
        $path =~ s!^https?://[^/]*!!;
        $path .= '/plugins/MailForm';
      }
      else {
        $path =~ s!/$!!;
      }
      return $path;
callbacks:
  restore:
    sub { runner('MailForm::DoSetting',
           'restore', @_); }
  cms_post_delete.mailform_setting:
    sub { runner('MailForm::DoSetting',
           'post_delete', @_); },
upgrade_functions:
  add_author_id_field:
    version_limit: 1.01
    code: \&add_author_id_field
  }
listing_screens:
  mailform_setting:
    primary: title
    default_sort_key: title
list_properties:
  mailform_setting:
    title:
      auto: 1
      label: Title
      display: force
      order: 200
      html: \&title_html
    id:
      base: __virtual.id
      label: ID
      order: 100
      display: optional
    description:
      auto: 1
      label: Description
      order: 300
      display: optional
    blog_id:
      auto: 1
      label: Blog ID
      display: optional
      order: 350
      html: sub {
        my ( $prop, $obj ) = @_;
        return $obj->blog_id;
    blog_name:
      base: __common.blog_name
      label: sub {
        my $blog = MT->app->blog;
        return ($blog && $blog->is_blog)
           ? MT->translate('Blog Name')
           : MT->translate('Website/Blog Name')
      display: sub {
        my $blog = MT->app->blog;
        return ($blog && $blog->is_blog) ? 'optional' : 'force';
      site_name: sub { MT->app->blog ? 0 : 1 }
      order: 400
    author_name:
      base: __virtual.author_name
      order: 500
      display: optional
